<!DOCTYPE html>
<html>
    <head>
        <title>CS-Play - Level 1</title>
        <link href="stylesheet.css" rel="stylesheet">

    </head>
    <body>
        <svg width="500px" height="500px" id="level">
            <rect id="computer" x="10" y="400" width="20" height="20" fill="grey" />
            <rect class="show-element" id="wall" x="200" y="0" width="20" height="500" fill="red"/>
            <circle id="goal" cx="450" cy="250" r="20" fill="yellow" />
            <text id="puzzle-solved-msg" x="300" y="30" fill="dodgerblue">You completed the puzzle!</text>
            <rect id="player" x="10" y="10" width="20" height="20" fill="black" />
        </svg>
        <svg width="500px" height="500px" id="terminal" class="hide-element">
            <text x="10" y="30" fill="white">print("Hello world")</text>
            <text x="10" y="390" fill="white">ENTER YOUR INPUT:</text>
            <rect x="0" y="400" width="500" height="1" fill="white"></rect>
            <text id="player-input" x="10" y="420" fill="white">This is where the player input will go eventually</text>
            <rect id="exit-button" x="430" y="460" width="60" height="30" stroke="white" stroke-width="1"></rect>
            <text id="exit-button" x="440" y="480" fill="white">EXIT</text>
        </svg>
        <script>
            const EXIT_BUTTON = document.querySelector("#exit-button");
            
            let computerPosition = 
            {
                x: 10,
                y: 400
            }

            let goalPosition =
            {
                x: 440,
                y: 240
            }

            let wallX = 200;

            let levelComplete = false;
            let puzzleSolved = false;
            
            let playerSize = 
            {
                width: 20,
                height: 20
            };
            
            let playerPosition = 
            {
                x: 10,
                y: 10
            };
            
            let moveRate = 10;
            
            let player = document.getElementById("player");
            let wall = document.getElementById("wall");
            let puzzle_solved_msg = document.getElementById("puzzle-solved-msg");
            let terminal = document.getElementById("terminal");


            function switchOffTerminal()
            {
                terminal.classList.remove("show-element");
                terminal.classList.add("hide-element");

                moveRate = 10;
            }
            
            function switchOnTerminal()
            {
                terminal.classList.remove("hide-element");
                terminal.classList.add("show-element");

                moveRate = 0;
            }
            
            function checkLevelComplete()
            {
                if(playerPosition.x == goalPosition.x && playerPosition.y == goalPosition.y)
                {
                    levelComplete = true;
                }

                if(levelComplete)
                {
                    alert("Level Complete!");
                }
            }
            
            function checkPuzzleSolved()
            {
                if(playerPosition.x == computerPosition.x && playerPosition.y == computerPosition.y)
                {
                    puzzleSolved = true;

                    switchOnTerminal();
                    
                    wall.classList.remove("show-element");
                    wall.classList.add("hide-element");

                    puzzle_solved_msg.classList.add("msg");
                }

            }
            
            function updateXPosition(distance)
            {
                playerPosition.x = playerPosition.x + distance;
                if(playerPosition.x < 0 || playerPosition.x > 480)
                {
                    playerPosition.x = playerPosition.x - distance;
                }

                if(playerPosition.x > 180 && puzzleSolved == false)
                {
                    playerPosition.x = playerPosition.x - distance;
                }
            }

            function updateYPosition(distance)
            {
                playerPosition.y = playerPosition.y - distance;
                if(playerPosition.y < 0 || playerPosition.y > 480)
                    {
                        playerPosition.y = playerPosition.y + distance;
                    }
            }

            function refreshPosition()
            {
                let x = playerPosition.x - (playerSize.width/2);
                let y = playerPosition.y - (playerSize.height/2);
                let transform = "translate(" + x + " " + y + ")";

                player.setAttribute("transform", transform);
            }

            window.addEventListener("keydown", function(event)
            {
                if(event.defaultPrevented)
                {
                    return;
                }
                if(event.code === "ArrowDown")
                {
                    updateYPosition(-moveRate);
                }
                else if(event.code === "ArrowUp")
                {
                    updateYPosition(moveRate);
                }
                else if(event.code === "ArrowLeft")
                {
                    updateXPosition(-moveRate);
                }
                else if(event.code === "ArrowRight")
                {
                    updateXPosition(moveRate);
                }
                refreshPosition();
                event.preventDefault();

                checkPuzzleSolved();
                checkLevelComplete();

            }, true)

            EXIT_BUTTON.addEventListener('click', switchOffTerminal);
            
        </script>
        <script>refreshPosition();</script>
    </body>
</html>